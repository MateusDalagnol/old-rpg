<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Distribua seus Pontos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Distribua seus pontos</h1>

        <form method="post" action="/distribuir_atributos">
            <input type="hidden" name="nome" value="{{ nome }}">
            <input type="hidden" name="classe" value="{{ classe }}">
            <input type="hidden" name="raca" value="{{ raca }}">
            <input type="hidden" name="estilo" value="{{ estilo }}">

            <h3>Valores disponíveis: {{ valores|join(' | ') }}</h3>

            <div id="atributos-container">
                {% for attr in ['forca','destreza','constituicao','inteligencia','sabedoria','carisma'] %}
                    <label>{{ attr|capitalize }}:
                        <select name="{{ attr }}" onchange="atualizarOpcoes()">
                            <option value="">-- Escolha um valor --</option>
                            {% for v in valores %}
                                <option value="{{ v }}">{{ v }}</option>
                            {% endfor %}
                        </select>
                    </label><br>
                {% endfor %}
            </div>

            <button type="submit">Criar Personagem</button>
        </form>
    </div>

    <script>
        const selects = document.querySelectorAll('select');
        const valoresIniciais = {{ valores|tojson }};

        function atualizarOpcoes() {
            // Conta a frequência de cada valor selecionado
            const contagemSelecionados = {};
            selects.forEach(select => {
                if (select.value !== '') {
                    contagemSelecionados[select.value] = (contagemSelecionados[select.value] || 0) + 1;
                }
            });

            // Conta a frequência de cada valor na lista original
            const contagemOriginais = {};
            valoresIniciais.forEach(valor => {
                contagemOriginais[valor] = (contagemOriginais[valor] || 0) + 1;
            });

            // Atualiza as opções de cada menu
            selects.forEach(select => {
                const valorAtual = select.value;
                const opcoes = select.querySelectorAll('option');

                opcoes.forEach(opcao => {
                    const valorOpcao = opcao.value;
                    if (valorOpcao !== '') {
                        const usado = contagemSelecionados[valorOpcao] || 0;
                        const total = contagemOriginais[valorOpcao] || 0;

                        // Desabilita a opção se ela já foi usada o número máximo de vezes e não é a opção atual
                        if (usado >= total && valorOpcao !== valorAtual) {
                            opcao.disabled = true;
                        } else {
                            opcao.disabled = false;
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>